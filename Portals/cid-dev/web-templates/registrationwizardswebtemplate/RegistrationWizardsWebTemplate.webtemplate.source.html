<script>
(function(webapi, $){
		function safeAjax(ajaxOptions) {
			var deferredAjax = $.Deferred();
	
			shell.getTokenDeferred().done(function (token) {
				// add headers for AJAX
				if (!ajaxOptions.headers) {
					$.extend(ajaxOptions, {
						headers: {
							"__RequestVerificationToken": token
						}
					}); 
				} else {
					ajaxOptions.headers["__RequestVerificationToken"] = token;
				}
				$.ajax(ajaxOptions)
					.done(function(data, textStatus, jqXHR) {
						validateLoginSession(data, textStatus, jqXHR, deferredAjax.resolve);
					}).fail(deferredAjax.reject); //AJAX
			}).fail(function () {
				deferredAjax.rejectWith(this, arguments); // on token failure pass the token AJAX and args
			});
	
			return deferredAjax.promise();	
		}
		webapi.safeAjax = safeAjax;
	})(window.webapi = window.webapi || {}, jQuery)

function CompanyHasNAICSCodes(companyId){
    return Validate(companyId, 'cid_company', 'Validation_CompanyNAICSCodes');
}

function CompanyHasERAPs(companyId){
    return Validate(companyId, 'cid_company', 'Validation_CompanyERAPs');
}

function SiteHasModeOfTransportations(siteId){
    return Validate(siteId, 'cid_site', 'Validation_SiteModeOfTransportations');
}

function SiteHasOperationClasses(operationId, siteId){
    if(operationId != null)
        return Validate(operationId, 'ovs_operationclass', 'Validation_SiteClasses');
    else if(siteId != null)
        return Validate(siteId, 'cid_site', 'Validation_SiteClasses');
    else
        return false;
}

function SiteHasOperationUNNumbers(operationId, siteId){
    if(operationId != null)
        return Validate(operationId, 'ovs_operationunnumber', 'Validation_SiteUNNumbers');
    else if(siteId != null)
        return Validate(siteId, 'cid_site', 'Validation_SiteUNNumbers');
    else
        return false;
}

function XOperationDetailsProvided(operationId){
    return Validate(operationId, 'ovs_siteid', 'Validation_OperationDetailsList');
}

function IsExtendedSite(operationId){
    var filter = "ovs_mocregistrationid eq guid'" + operationId + "'";
	var data = ExecuteQuery("Validation_OperationDetailsList", filter);

    if(data.length > 0)
        return data[0]['cid_extendedsite'];
    else
        return false;
}

function Validate(recordId, fieldName, list){
    var filter = fieldName + "/Id eq (guid'" + recordId + "')";
	var data = ExecuteQuery(list, filter);

    if(data != null && data.length > 0)
        return true;
    else
        return false;
}

function ExecuteQuery(list, filter){
    var url = list + "?$filter=" + filter;
    var oDataUrl = "~/_odata/" + url;
    var response = null;

    $.ajax({
        type: "GET",
        url: oDataUrl,
        dataType: "json",
        async: false
    }).done(function (json) {
        response = json.value;
    });
    return response;
}

function SetOperationDetailsProvided(operationId){
    webapi.safeAjax({
     type: "PATCH",
     url: "/_api/ovs_mocregistration(" + operationId + ")",
     contentType: "application/json",
     data: JSON.stringify({
       //"cid_operationdetailsprovided": "1"
       "ovs_cepsampling_strataname" : "X"
     }),
     success: function (res) {
       //alert(res);
       alert('Success');
     },
     error: function(){
        alert('Fail');
     }
   });
}

</script>
 <script type="text/javascript" src="~/tdgcore_common.js" ></script>